import{d as O,K,r as z,B as L,A as J,Q as X,O as Y,G as h,a,b as t,w as s,L as Z,R as $,v as o,N as ee,f as le,C as te,S as se,T as oe,U as ne,m as de,V as i,c as y,n as ae,q as re,s as ue,j as m,e as ie,p as pe,I as me,D as _e,F as fe,W as _,u as H,i as be,k as ye,y as p,x as U}from"./index-DneuEjkn.js";const he={key:0},ce={key:1},ge={key:2},we={key:3},ve={key:4},qe=O({__name:"SysInit",setup(Se){let q=K(),k=Y();const l=z({sqlite_dbdsn:"gowebssh.db",mysql_dbdsn:"",pgsql_dbdsn:"",db_type:"sqlite",name:"",pwd:"",sshd_host:"0.0.0.0",sshd_port:22622,sshd_user:"",sshd_pwd:""});let S=L(()=>l.db_type=="mysql"?l.mysql_dbdsn:l.db_type=="pgsql"?l.pgsql_dbdsn:l.db_type=="sqlite"?l.sqlite_dbdsn:""),B=L(()=>l.db_type=="mysql"?"MySQL":l.db_type=="pgsql"?"PostgreSQL":l.db_type=="sqlite"?"SQLite":"");const d=J(0),Q=()=>{d.value--<0&&(d.value=0)},I=()=>{d.value++>2&&(d.value=0)};function M(){let r=S.value.trim();if(r.length<2){p.error("请输入正确配置");return}U.post("/api/sys/db_conn_check",{db_type:l.db_type,db_dsn:r}).then(e=>{e.data.code===0?p.success("连接数据库成功"):p.error("连接数据库错误:"+e.data.msg)}).catch(e=>{p.error("连接数据库错误异常")})}function E(r){let e="";const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",w=g.length;for(let f=0;f<r;f++)e+=g.charAt(Math.floor(Math.random()*w));return e}function x(){let r={db_type:l.db_type,db_dsn:S.value.trim(),jwt_secret:E(64),session_secret:E(64),username:l.name.trim(),password:l.pwd.trim(),sshd_host:l.sshd_host.trim(),sshd_port:l.sshd_port,sshd_user:l.sshd_user.trim(),sshd_pwd:l.sshd_pwd.trim()};if(r.db_dsn.length<5){p.error("系统初始化错误:请输入正确的数据库连接");return}if(r.username.length<2){p.error("系统初始化错误:Web登录账号至少两个字符");return}if(r.password.length<2){p.error("系统初始化错误:Web登录密码至少两个字符");return}if(r.sshd_user.length<2){p.error("系统初始化错误:SSH服务器登录账号至少两个字符");return}if(r.sshd_pwd.length<2){p.error("系统初始化错误:SSH服务器登录密码至少两个字符");return}U.post("/api/sys/init",r).then(e=>{e.data.code===0?(p.success("系统初始化成功"),q.isInit=!0,k.push({name:"Login"})):p.error("系统初始化错误:"+e.data.msg)}).catch(e=>{console.log(e),p.error("系统初始化错误异常")})}return X(()=>{q.isInit&&k.push({name:"Login"})}),(r,e)=>{const g=$,w=te,f=oe,N=se,W=ne,V=ue,T=re,u=ae,b=pe,v=ie,D=me,C=fe,P=_e,c=be,R=ye,F=de,G=le,j=ee,A=Z;return a(),h("div",null,[t(A,null,{default:s(()=>[t(g,null,{default:s(()=>[...e[10]||(e[10]=[o("h1",{style:{"text-align":"center"}},"系统初始化",-1)])]),_:1}),t(j,null,{default:s(()=>[t(G,null,{default:s(()=>[t(w,{span:4}),t(w,{span:16},{default:s(()=>[o("div",null,[t(N,{active:d.value,"finish-status":"success"},{default:s(()=>[t(f,{title:"数据库选择"}),t(f,{title:"Web账号配置"}),t(f,{title:"SSH服务器配置"}),t(f,{title:"完成"})]),_:1},8,["active"]),t(W),t(F,{model:l},{default:s(()=>[d.value===0?(a(),h("div",he,[t(u,{label:"数据库"},{default:s(()=>[t(T,{modelValue:l.db_type,"onUpdate:modelValue":e[0]||(e[0]=n=>l.db_type=n)},{default:s(()=>[t(V,{value:"sqlite"},{default:s(()=>[...e[11]||(e[11]=[m("SQLite",-1)])]),_:1}),t(V,{value:"mysql"},{default:s(()=>[...e[12]||(e[12]=[m("MySQL",-1)])]),_:1}),t(V,{value:"pgsql"},{default:s(()=>[...e[13]||(e[13]=[m("PostgresSQL",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l.db_type==="sqlite"?(a(),y(u,{key:0},{default:s(()=>[t(v,{style:{width:"100%"}},{header:s(()=>[...e[14]||(e[14]=[o("div",{class:"card-header"},[o("span",null,"样例:  gowebssh.db")],-1)])]),default:s(()=>[t(b,{modelValue:l.sqlite_dbdsn,"onUpdate:modelValue":e[1]||(e[1]=n=>l.sqlite_dbdsn=n),minlength:"10",maxlength:"65535","show-word-limit":"",clearable:"",placeholder:"请输入Sqlite数据库连接配置,参考上面的样例"},null,8,["modelValue"])]),_:1})]),_:1})):i("",!0),l.db_type==="mysql"?(a(),y(u,{key:1},{default:s(()=>[t(v,{style:{width:"100%"}},{header:s(()=>[...e[15]||(e[15]=[o("div",{class:"card-header"},[o("span",null,"样例:  root:mypwd@tcp(192.168.150.200:3306)/mydb?charset=utf8mb4&parseTime=True&loc=Local")],-1)])]),default:s(()=>[t(b,{modelValue:l.mysql_dbdsn,"onUpdate:modelValue":e[2]||(e[2]=n=>l.mysql_dbdsn=n),minlength:"10",maxlength:"65535","show-word-limit":"",clearable:"",placeholder:"请输入MySQL数据库连接配置,参考上面的样例"},null,8,["modelValue"])]),_:1})]),_:1})):i("",!0),l.db_type==="pgsql"?(a(),y(u,{key:2},{default:s(()=>[t(v,{style:{width:"100%"}},{header:s(()=>[...e[16]||(e[16]=[o("div",{class:"card-header"},[o("span",null,"样例:  host=192.168.150.200 port=5432 user=postgres dbname=mydb sslmode=disable password=mypwd")],-1)])]),default:s(()=>[t(b,{modelValue:l.pgsql_dbdsn,"onUpdate:modelValue":e[3]||(e[3]=n=>l.pgsql_dbdsn=n),minlength:"10",maxlength:"65535","show-word-limit":"",clearable:"",placeholder:"请输入PostgresSQL数据库连接配置,参考上面的样例"},null,8,["modelValue"])]),_:1})]),_:1})):i("",!0)])):i("",!0),d.value===1?(a(),h("div",ce,[o("div",null,[t(u,{label:"Web登录账号:"},{default:s(()=>[t(b,{modelValue:l.name,"onUpdate:modelValue":e[4]||(e[4]=n=>l.name=n),trim:"",minlength:"1",maxlength:"64","show-word-limit":"",clearable:"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(u,{label:"Web登录密码:"},{default:s(()=>[t(b,{modelValue:l.pwd,"onUpdate:modelValue":e[5]||(e[5]=n=>l.pwd=n),trim:"",type:"password",minlength:"3",maxlength:"64","show-word-limit":"","show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})])])):i("",!0),d.value===2?(a(),h("div",ge,[o("div",null,[t(u,{label:"SSH服务器登录账号:"},{default:s(()=>[t(b,{modelValue:l.sshd_user,"onUpdate:modelValue":e[6]||(e[6]=n=>l.sshd_user=n),trim:"",minlength:"1",maxlength:"64","show-word-limit":"",clearable:"",placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),t(u,{label:"SSH服务器登录密码:"},{default:s(()=>[t(b,{modelValue:l.sshd_pwd,"onUpdate:modelValue":e[7]||(e[7]=n=>l.sshd_pwd=n),trim:"",type:"password",minlength:"3",maxlength:"64","show-word-limit":"","show-password":"",clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(u,{label:"SSH服务器监听端口:"},{default:s(()=>[t(D,{modelValue:l.sshd_port,"onUpdate:modelValue":e[8]||(e[8]=n=>l.sshd_port=n),min:1,max:65535},null,8,["modelValue"])]),_:1}),t(u,{label:"SSH服务器监听地址:"},{default:s(()=>[t(P,{modelValue:l.sshd_host,"onUpdate:modelValue":e[9]||(e[9]=n=>l.sshd_host=n),placeholder:"选择监听地址"},{default:s(()=>[t(C,{label:"0.0.0.0",value:"0.0.0.0"}),t(C,{label:"127.0.0.1",value:"127.0.0.1"})]),_:1},8,["modelValue"])]),_:1})])])):i("",!0),d.value===3?(a(),h("div",we,[t(u,null,{default:s(()=>[t(v,{style:{width:"100%"}},{header:s(()=>[...e[17]||(e[17]=[o("div",{class:"card-header"},[o("span",{style:{color:"red"}},"配置确认,请妥善保存密码")],-1)])]),default:s(()=>[o("p",null,"数据库类型:  "+_(H(B)),1),o("p",null,"数据库DSN:  "+_(H(S)),1),o("p",null,"Web登录账号:  "+_(l.name),1),o("p",null,"Web登录密码:  "+_(l.pwd),1),o("p",null,"SSH服务器登录账号:  "+_(l.sshd_user),1),o("p",null,"SSH服务器登录密码:  "+_(l.sshd_pwd),1),o("p",null,"SSH服务器监听端口:  "+_(l.sshd_port),1),o("p",null,"SSH服务器监听地址:  "+_(l.sshd_host),1)]),_:1})]),_:1})])):i("",!0),o("div",null,[t(u,null,{default:s(()=>[d.value===0?(a(),y(c,{key:0,type:"success",onClick:M},{default:s(()=>[...e[18]||(e[18]=[m("测试连接",-1)])]),_:1})):i("",!0),d.value>0?(a(),y(c,{key:1,type:"primary",onClick:Q},{default:s(()=>[...e[19]||(e[19]=[m("上一步",-1)])]),_:1})):i("",!0),d.value<3?(a(),y(c,{key:2,type:"primary",onClick:I},{default:s(()=>[...e[20]||(e[20]=[m("下一步",-1)])]),_:1})):i("",!0),d.value===3?(a(),y(c,{key:3,type:"success",onClick:x},{default:s(()=>[...e[21]||(e[21]=[m("完成",-1)])]),_:1})):i("",!0),e[24]||(e[24]=m("                    ",-1)),d.value===3?(a(),h("div",ve,[t(R,{confirmButtonText:"确定",cancelButtonText:"取消",icon:"el-icon-info",iconColor:"red",title:"确定初始化",onConfirm:x},{reference:s(()=>[e[23]||(e[23]=m("   ",-1)),t(c,{type:"success"},{default:s(()=>[...e[22]||(e[22]=[m("完成",-1)])]),_:1})]),_:1})])):i("",!0)]),_:1})])]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1})]),_:1})])}}});export{qe as default};
